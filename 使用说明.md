# 使用说明

## 一、项目简介
本项目基于 ESP32 平台，结合 OLED 屏幕、CAN 总线、油压传感器、RTC 实时时钟等硬件，实现 BRZ/FRS/GT86 车型的多功能仪表显示与数据采集。支持本地显示与 Web 配置，适合 DIY 改装及数据监控。

---

## 二、环境准备
1. **硬件需求**：
   - ESP32 开发板
   - OLED 屏幕（I2C 接口）
   - 按键 x3
   - 油压传感器
   - MCP2515 CAN 总线模块（SPI 接口）
   - DS3231 实时时钟模块（I2C 接口）
   - 连接线材等

2. **软件需求**：
   - [PlatformIO](https://platformio.org/)（推荐 VSCode 插件）
   - 驱动库依赖：U8g2、mcp_can、WiFiManager、NTPClient、RTClib、ArduinoJson（已在 `platformio.ini` 配置）

---

## 三、硬件接线
详见《硬件接线说明.md》，主要接口如下：

| 设备/信号         | ESP32 引脚 | 说明                |
|-------------------|------------|---------------------|
| OLED SCL          | 22         | I2C 时钟            |
| OLED SDA          | 21         | I2C 数据            |
| 按钮1             | 2          | 上拉输入            |
| 按钮2             | 34         | 上拉输入            |
| 按钮3             | 35         | 上拉输入            |
| 油压传感器        | A0         | 模拟输入            |   
| MCP2515 CS        | 5          | SPI 片选            |
| MCP2515 INT       | 4          | 中断                |
| MCP2515 SCK       | 18*        | SPI 时钟（默认）    |
| MCP2515 MOSI      | 23*        | SPI 主出从入（默认）|
| MCP2515 MISO      | 19*        | SPI 主入从出（默认）|
| DS3231 SCL        | 22         | I2C 时钟            |
| DS3231 SDA        | 21         | I2C 数据            |

> 详细说明及功能分配请参考《硬件接线说明.md》

---

## 四、编译与上传
1. 使用 VSCode 打开本项目文件夹。
2. 安装 PlatformIO 插件。
3. 连接 ESP32 开发板至电脑。
4. 检查 `platformio.ini`，确认开发板型号与端口设置。
5. 点击 PlatformIO 的"Build"进行编译。
6. 点击"Upload"上传固件。
7. 若需上传网页资源，使用 PlatformIO 的"Upload File System image"功能，将 `data/` 目录内容烧录至 SPIFFS。

---

## 五、功能说明
### 1. 屏幕与按键操作
- 默认显示时钟、油温、冷却液温度、油压、AFR、电压等信息。
- 按钮一（2号引脚）：长按配合按钮二切换单位（如温度、压力单位）。
- 按钮二（34号引脚）：调整时钟小时数，或配合按钮三切换屏幕模式。
- 按钮三（35号引脚）：调整分钟数，或配合按钮二切换屏幕模式。

### 2. Web 配置界面
- 设备上电后，连接其 WiFi 热点（如有配置 WiFiManager）。
- 浏览器访问 `192.168.4.1` 或设备分配到的 IP 地址。
- 进入 Web 配置界面，可进行：
  - 时间同步（NTP）
  - 显示模式切换（Logo、时钟、油温、冷却液温度、油压、AFR、电压、设置等）
  - 压力单位（BAR/PSI）、温度单位（℃/℉）、时间制式（24h/12h）、AFR 显示方式（AFR/Lambda）切换

---

## 六、常见问题与注意事项
- **模拟数据**：如需关闭模拟数据，注释 `loop.cpp` 中的 `void updateSimulatedSensorData()` 调用。
- **库依赖**：首次编译会自动下载依赖库，若失败请检查网络或手动安装。
- **SPI/I2C 引脚**：部分开发板引脚可能需自定义，请参考实际板卡原理图。
- **Web 页面无法访问**：请确认设备已连接 WiFi，或尝试重启。
- **更多问题**：详见各 .md 文档及源代码注释。

---

## 七、参考与扩展
- 项目结构、详细功能请参考《项目结构说明.md》
- 可根据实际需求扩展传感器、显示内容及 Web 配置项。
- 项目开源地址：[Github](https://github.com/mg-arne/gt86clock)

---